<div id="kt_quick_user" class="offcanvas p-10" [ngClass]="extrasUserOffcanvasDirection">
  <ng-container *ngIf="user$ | async as _user">
    <div class="offcanvas-header d-flex align-items-center justify-content-between pb-5">
      <h3 class="font-weight-bold m-0">
        Thông tin cá nhân

        <!--        Notify-->
        <!--        <small class="text-muted font-size-sm ml-2">Chưa có notify</small>-->
      </h3>
      <a href="#" class="btn btn-xs btn-icon btn-light btn-hover-primary" id="kt_quick_user_close">
        <em class="ki ki-close icon-xs text-muted"></em>
      </a>
    </div>

    <div class="offcanvas-content pr-5 mr-n5">
      <div class="d-flex align-items-center mt-5">
        <div class="symbol symbol-100 mr-5">
          <div class="symbol-label" *ngIf='_user.accountAuth?.profile?.avatar?.url'
            [ngStyle]="{ 'background-image': 'url(' + _user.accountAuth?.profile?.avatar?.url + ')'}"></div>
          <div class="symbol-label" *ngIf='!_user.accountAuth?.profile?.avatar?.url'
            [ngStyle]="{ 'background-image': 'url(assets/media/sun-oil/employee/placeholder-user.png'}"></div>
          <em class="symbol-badge bg-success"></em>
        </div>
        <div class="d-flex flex-column">
          <a class="font-weight-bold font-size-h5 text-dark-75 text-hover-primary">
            {{ _user.accountAuth?.username }}
          </a>
          <div class="navi mt-2">
            <a class="btn btn-sm btn-light-primary font-weight-bolder py-2 px-5 cursor-pointer" (click)="logout()">Đăng
              xuất</a>
          </div>
        </div>
      </div>

      <div class="separator separator-dashed mt-8 mb-5"></div>

      <div class="navi navi-spacer-x-0 p-0">
        <div class='row py-3'>
          <div class='col-lg-5'>Tên nhân viên</div>
          <div class='col-lg-7'>
            <strong>{{ _user.accountAuth?.profile?.name }}</strong>
          </div>
        </div>
        <div class='row py-3'>
          <div class='col-lg-5'>Mã nhân viên</div>
          <div class='col-lg-7'>
            <strong>{{ _user.accountAuth?.profile?.code }}</strong>
          </div>
        </div>
        <div class='row py-3'>
          <div class='col-lg-5'>Số điện thoại</div>
          <div class='col-lg-7'>
            <strong>{{ _user.accountAuth?.profile?.phone }}</strong>
          </div>
        </div>
        <div class='row py-3'>
          <div class='col-lg-5'>CMND/CCCD</div>
          <div class='col-lg-7'>
            <strong>{{ _user.accountAuth?.profile?.idCard }}</strong>
          </div>
        </div>
        <div class='row py-3'>
          <div class='col-lg-5'>Email</div>
          <div class='col-lg-7'>
            <strong>{{ _user.accountAuth?.profile?.email }}</strong>
          </div>
        </div>
        <div class='row py-3'>
          <div class='col-lg-5'>Mật khẩu</div>
          <div class='col-lg-7'>
            <a class="btn btn-sm btn-light-primary font-weight-bolder py-2 px-5 cursor-pointer" (click)="showChangePassworkModal($event)">Đổi mật khẩu</a>
          </div>
        </div>
        <div class="form-group row align-items-center py-3">
          <label class="col-5 col-form-label">Xác thực 2 bước</label>
          <div class="col-7 d-flex justify-content-start">
            <span class="switch switch-primary switch-sm">
              <label>
                <input type="checkbox" name="select-two-auth-step" [formControl]="enableTwoAuthStepControl" (click)='openModal()'/>
                <span></span>
              </label>
            </span>
          </div>
        </div>
      </div>

      <div class="separator separator-dashed my-7"></div>
    </div>
  </ng-container>
</div>

<ng-template #changePasswork>
  <div class="modal-header">
    <h4 class="modal-title">Đổi mật khẩu</h4>
  </div>
  <div class="modal-body password-wrapper">
    <form [formGroup]='changPasswordForm'>
      <div class="form-group">
        <div class="d-flex justify-content-between mt-n5">
          <label class="font-size-h6 pt-5 form-label required">Mật khẩu cũ</label>
        </div>
        <div class="position-relative">
          <input
            placeholder="Nhập mật khẩu cũ"
            class="form-control form-control-solid h-auto"
            [type]="isShowPasswordStatus ? 'text' : 'password'"
            autocomplete="off"
            formControlName="passwordOld"
            (input)="onInputPassword($event)"
            (keydown.space)="$event.preventDefault()"
            maxlength="32"
          />
        </div>
        <app-validate
          [control]="changPasswordForm.controls['passwordOld']"
          [error]="'required'"
          [message]="'Mật khẩu cũ không được để trống'"
        ></app-validate>
        <app-validate
          [control]="changPasswordForm.controls['passwordOld']"
          [error]="'wrongOldPassword'"
          [message]="'Mật khẩu cũ không đúng'"
        ></app-validate>
      </div>

      <div class="form-group">
        <div class="d-flex justify-content-between mt-n5">
          <label class="font-size-h6 pt-5 form-label required">Mật khẩu mới</label>
        </div>
        <div class="position-relative">
          <input
            placeholder="Nhập mật khẩu mới"
            class="form-control form-control-solid h-auto"
            [type]="isShowPasswordStatus ? 'text' : 'password'"
            autocomplete="off"
            formControlName="passwordNew"
            (input)="onInputPassword($event)"
            (keydown.space)="$event.preventDefault()"
            maxlength="32"
          />
        </div>
        <app-validate
          [control]="changPasswordForm.controls['passwordNew']"
          [error]="'required'"
          [message]="'Mật khẩu mới không được để trống'"
        ></app-validate>
        <app-validate
          [control]="changPasswordForm.controls['passwordNew']"
          [error]="'regPasswordNew'"
          [message]="'Mật khẩu mới tối thiểu 8 ký tự'"
        ></app-validate>
      </div>

      <div class="form-group">
        <div class="d-flex justify-content-between mt-n5">
          <label class="font-size-h6 pt-5 form-label required">Nhập lại mật khẩu mới</label>
        </div>
        <div class="position-relative">
          <input
            placeholder="Nhập lại mật khẩu mới"
            class="form-control form-control-solid h-auto"
            [type]="isShowPasswordStatus ? 'text' : 'password'"
            autocomplete="off"
            formControlName="repeatPassword"
            (input)="onInputPassword($event)"
            (keydown.space)="$event.preventDefault()"
            maxlength="32"
          />
        </div>
        <app-validate
          [control]="changPasswordForm.controls['repeatPassword']"
          [error]="'required'"
          [message]="'Mật khẩu nhập lại không được để trống'"
        ></app-validate>
        <app-validate
          [control]="changPasswordForm.controls['repeatPassword']"
          [error]="'incorrectPassword'"
          [message]="'Mật khẩu xác nhận không khớp'"
        ></app-validate>
        <app-validate
          [control]="changPasswordForm.controls['repeatPassword']"
          [error]="'pattern'"
          [message]="'Mật khẩu xác nhận không đúng định dạng'"
        ></app-validate>
        <app-validate
          [control]="changPasswordForm.controls['repeatPassword']"
          [error]="'regPasswordNew'"
          [message]="'Mật khẩu mới tối thiểu 8 ký tự'"
        ></app-validate>
      </div>

      <div class="form-group row mt-3">
        <div class="col-lg-12 d-flex align-items-center">
          <label class="checkbox checkbox-lg mr-2">
            <input
              type="checkbox"
              id="show-password"
              formControlName='showPassword'
            />
            <span (click)="$event.stopPropagation()"></span>
          </label>

          <label class="m-0" for="show-password"> Hiển thị mật khẩu </label>
        </div>
      </div>
    </form>
  </div>
  <div class="modal-footer">
    <button
      type="button"
      class="btn btn-outline-secondary"
      (click)='activeModal.close(false)'
    >
      Hủy
    </button>
    <button
      type="button"
      class="btn btn-primary"
      (click)='confirmChangePassword()'
    >
      Xác nhận
    </button>
  </div>
</ng-template>
