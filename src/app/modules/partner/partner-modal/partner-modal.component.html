<div class="modal-content">
	<div class="modal-header">
		<h4 class="modal-title" id="modal-title">
			{{ isUpdate ? 'Sửa thông tin tài xế' : 'Thêm mới tài xế' }}
		</h4>
		<div class="close-icon" (click)="modal.close()"></div>
	</div>
	<div class="modal-body">
		<div class="overlay overlay-block cursor-default modal-body" style="min-height: 300px">
			<form [formGroup]="partnerForm" class="form form-label-right">
				<div class="form-group row">
					<div class="col-lg-6 customer-phone">
						<label class="form-label required">Số điện thoại</label>
						<div>
							<input
								class="form-control form-control-lg form-control-solid input-phone"
								placeholder="Nhập số điện thoại để tìm kiếm"
								formControlName="phone"
								autocomplete="off"
								(keydown.space)="$event.preventDefault()"
								maxlength="12"
								numbersOnly
								[numberformControl]="partnerForm.controls['phone']"
							/>
							<em *ngIf="!isUpdate" class="fa fa-times" (click)="deleteNumberPhone()"></em>
						</div>
						<app-validate
							[control]="partnerForm.controls['phone']"
							[error]="'required'"
							[message]="'Số diện thoại không được để trống'"
						></app-validate>
						<app-validate
							[control]="partnerForm.controls['phone']"
							[error]="'notFound'"
							[message]="'Không tìm thấy số điện thoại'"
						></app-validate>
						<app-validate
							[control]="partnerForm.controls['phone']"
							[error]="'current'"
							[message]="'Bạn không thể thêm chính mình vào tài khoản con'"
						></app-validate>
						<app-validate
							[control]="partnerForm.controls['phone']"
							[error]="'isEnterprise'"
							[message]="'Tài khoản là chủ doanh nghiệp vận tải'"
						></app-validate>
						<app-validate
							[control]="partnerForm.controls['phone']"
							[error]="'existed'"
							[message]="'Tài khoản con đã tồn tại'"
						></app-validate>
					</div>

					<div class="col-lg-6">
						<label class="form-label required">Họ và tên</label>
						<input
							type="text"
							class="form-control form-control-lg form-control-solid"
							formControlName="name"
							autocomplete="off"
							disabled
						/>
					</div>
				</div>
				<div class="form-group row">
					<div class="col-lg-6">
						<label class="form-label required">Xe sử dụng</label>
						<ng-select
							[multiple]="true"
							formControlName="vehicleIds"
							[closeOnSelect]="false"
							[placeholder]="'Chọn xe sử dụng'"
							[notFoundText]="'...'"
						>
							<ng-option *ngFor="let vehicle of vehicles" [value]="vehicle.id"
								>{{ vehicle.numberVariable }}</ng-option
							>
						</ng-select>
						<app-validate
							[control]="partnerForm.controls['vehicleIds']"
							[error]="'required'"
							[message]="'Xe sử dụng không được để trống'"
						></app-validate>
					</div>
				</div>
				<div
					class="form-group row"
					*ngIf="(isLoadingForm$ |async) && cashLimitOilFormArray.length > 0"
				>
					<div class="list-product col-lg-12">
						<h3 class="title">Thông tin hạn mức nhiên liệu</h3>
						<div class="table-responsive angular-bootstrap-table">
							<form [formGroup]="partnerForm">
								<table class="table table-vertical-center overflow-hidden" aria-label="">
									<thead class="thead-light">
										<tr>
											<th scope="">
												<label class="form-label">STT</label>
											</th>
											<th scope="">
												<label class="form-label">Loại nhiên liệu</label>
											</th>
											<th scope="">
												<label class="form-label">Hạn mức cho tài xế</label>
											</th>
											<th scope="">
												<label class="form-label">Hạn mức còn lại của doanh nghiệp</label>
											</th>
											<th scope="">
												<label class="form-label">Đơn vị</label>
											</th>
										</tr>
									</thead>

									<tbody>
										<ng-container formArrayName="cashLimitOil">
											<tr
												*ngFor="let cashLimitOilFormGroup of cashLimitOilFormArray.controls; let i = index"
											>
												<ng-container [formGroup]="cashLimitOilFormGroup">
													<td>{{i + 1}}</td>
													<td [textContent]="cashLimitOilFormGroup.get('productName').value"></td>
													<td class="col2">
														<input
															placeholder="Nhập hạn mức"
															class="form-control form-control-sm"
															formControlName="cashLimitOil"
															maxlength="6"
															numbersOnly
															[numberformControl]="cashLimitOilFormGroup.get('cashLimitOil')"
														/>
														<app-validate
															[control]="cashLimitOilFormGroup.get('cashLimitOil')"
															[error]="'min'"
															[message]="'Hạn mức phải lớn hơn 0'"
														></app-validate>
														<app-validate
															[control]="cashLimitOilFormGroup.get('cashLimitOil')"
															[error]="'max'"
															[message]="'Hạn mức lớn hơn hạn mức tối đa'"
														></app-validate>
													</td>
													<td
														class="col3"
														[textContent]="cashLimitOilFormGroup.get('maxCashLimitOil').value"
													></td>
													<td
														class="col4"
														[textContent]="cashLimitOilFormGroup.get('unitCashLimitOil').value"
													></td>
												</ng-container></tr
										></ng-container>
									</tbody>
								</table>
							</form>
						</div>
					</div>
				</div>
				<div class="form-group row" *ngIf="cashLimitMoneyMaster > 0">
					<div class="list-product col-lg-12">
						<h3 class="title">Thông tin hạn mức tiền</h3>
						<label class="text-black-50" *ngIf="isUpdate"
							>Hạn mức đang có Tiền: {{cashLimitMoneyChild |number|vnCurrency}} VNĐ</label
						>
					</div>
					<div class="col-lg-6">
						<label class="form-label">Hạn mức tiền</label>
						<input
							type="text"
							class="form-control form-control-lg form-control-solid mb-1"
							formControlName="cashLimitMoney"
							placeholder="Nhập số tiền"
							autocomplete="off"
							numbersOnly
							[numberformControl]="partnerForm.get('cashLimitMoney')"
							decimal-mask
							maxlength="18"
						/>
						<app-validate
							[control]="partnerForm.get('cashLimitMoney')"
							[error]="'min'"
							[message]="'Hạn mức tiền phải lớn hơn 0'"
						></app-validate>
						<app-validate
							[control]="partnerForm.get('cashLimitMoney')"
							[error]="'max'"
							[message]="'Hạn mức tiền lớn hơn hạn mức tiền tối đa'"
						></app-validate>
						<strong class="text-warning"
							>Hạn mức còn lại: {{cashLimitMoneyMaster |number|vnCurrency}} VNĐ</strong
						>
					</div>
				</div>
			</form>
		</div>
	</div>
	<div class="modal-footer">
		<button type="button" class="btn btn-outline-secondary btn-dialog" (click)="onClose()">
			Hủy
		</button>
		<button type="button" ngbAutofocus class="btn btn-primary btn-dialog" (click)="onSubmit()">
			{{isUpdate ? 'Lưu': 'Gửi yêu cầu'}}
		</button>
	</div>
</div>
