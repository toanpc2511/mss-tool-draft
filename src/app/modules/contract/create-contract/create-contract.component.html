<div class="card card-custom gutter-b mt-1">
	<div class="info-customer">
		<div class="card-header">
			<div class="card-title">
				<h3 class="title">Thông tin khách hàng</h3>
			</div>
		</div>

		<div class="card-body">
			<form [formGroup]="infoForm" class="form form-label-right">
				<div class="form-group row">
					<div class="col-lg-4 customer-phone">
						<label class="form-label required">Số điện thoại</label>
						<div>
							<input
								type="number"
								class="form-control form-control-lg form-control-solid input-phone"
								placeholder="Nhập số điện thoại"
								formControlName="phone"
								(blur)="getInfoUser()"
								autocomplete="off"
								trim="blur"
								(keydown.space)="$event.preventDefault()"
							/>
							<i class="fa fa-times" (click)="deleteNumberPhone()"></i>
						</div>
						<app-validate
							[control]="infoForm.controls['phone']"
							[error]="'required'"
							[message]="'Số diện thoại không được để trống'"
						></app-validate>
						<app-validate
							[control]="infoForm.controls['phone']"
							[error]="'phoneExisted'"
							[message]="'Số diện thoại không tồn tại trên hệ thống'"
						></app-validate>
					</div>

					<div class="col-lg-4">
						<label class="form-label required">Tên khách hàng</label>
						<input
							disabled
							formControlName="name"
							class="form-control form-control-lg form-control-solid"
						/>
					</div>

					<div class="col-lg-4">
						<label class="form-label required">Tên doanh nghiệp</label>
						<input
							disabled
							formControlName="enterpriseName"
							class="form-control form-control-lg form-control-solid"
						/>
					</div>
				</div>

				<div class="form-group row">
					<div class="col-lg-4">
						<label class="form-label">Ngày sinh</label>
						<input
							#birthDate
							disabled
							formControlName="dateOfBirth"
							class="form-control form-control-lg form-control-solid"
							[value]="birthDate.value |date: 'dd/MM/yyyy'"
						/>
					</div>

					<div class="col-lg-4">
						<label class="form-label required">CMND/CCCD</label>
						<input
							disabled
							formControlName="idCard"
							class="form-control form-control-lg form-control-solid"
						/>
					</div>

					<div class="col-lg-4">
						<label class="form-label">Email</label>
						<input
							disabled
							formControlName="email"
							class="form-control form-control-lg form-control-solid"
						/>
					</div>
				</div>

				<div class="form-group row">
					<div class="col-lg-8">
						<label class="form-label required">Địa chỉ</label>
						<input
							disabled
							formControlName="address"
							class="form-control form-control-lg form-control-solid"
						/>
					</div>
				</div>
			</form>
		</div>
	</div>

	<div class="info-contract">
		<div class="card-header">
			<div class="card-title">
				<h3 class="title">Thông tin hợp đồng</h3>
			</div>
		</div>

		<div class="card-body">
			<form [formGroup]="contractForm" class="form form-label-right">
				<div class="form-group row">
					<div class="col-lg-4">
						<label class="form-label required">Loại hợp đồng</label>
						<select
							class="form-control form-control-lg form-control-solid"
							formControlName="contractTypeCode"
						>
							<option *ngFor="let item of contractTypes" [ngValue]="item.code">
								{{item.name}}
							</option>
						</select>
					</div>

					<div class="col-lg-4">
						<label class="form-label required">Tên hợp đồng</label>
						<input
							class="form-control form-control-lg form-control-solid"
							placeholder="Nhập tên hợp đồng"
							maxlength="99"
							autocomplete="off"
							formControlName="name"
							trim="blur"
						/>
						<app-validate
							[control]="contractForm.controls['name']"
							[error]="'required'"
							[message]="'Tên hợp không được để trống'"
						></app-validate>
					</div>

					<div class="col-lg-4">
						<label class="form-label">Ngày hết hạn</label>
						<div class="input-group">
							<input
								class="form-control form-control-lg form-control-solid"
								placeholder="DD/MM/YYYY"
								ngbDatepicker
								#effectEndDate="ngbDatepicker"
								formControlName="effectEndDate"
							/>
							<div class="input-group-append">
								<button
									class="btn btn-outline-secondary fa fa-calendar-alt"
									(click)="effectEndDate.toggle()"
									type="button"
								></button>
							</div>
						</div>
						<app-validate
							[control]="contractForm.controls['effectEndDate']"
							[error]="'ngbDate'"
							[message]="'Ngày hết hạn không đúng định dạng'"
						></app-validate>
					</div>
				</div>

				<div class="form-group row">
					<div class="col-lg-4">
						<label class="form-label">HT giao nhận</label>
						<select
							class="form-control form-control-lg form-control-solid"
							formControlName="transportMethodCode"
						>
							<option disabled [value]="null">Chọn HT giao nhận</option>
							<option *ngFor="let item of transportMethods" [value]="item.code">
								{{ item.name }}
							</option>
						</select>
					</div>

					<div class="col-lg-4">
						<label class="form-label required">HT thanh toán</label>
						<select
							class="form-control form-control-lg form-control-solid"
							formControlName="payMethodCode"
						>
							<option disabled [value]="null">Chọn HT thanh toán</option>
							<option *ngFor="let item of paymentMethods" [value]="item.code">
								{{ item.name }}
							</option>
						</select>
						<app-validate
							[control]="contractForm.controls['payMethodCode']"
							[error]="'required'"
							[message]="'HT thanh toán không được để trống'"
						></app-validate>
					</div>

					<div class="col-lg-4">
						<label class="form-label required">Địa chỉ ký hợp đồng</label>
						<select
							class="form-control form-control-lg form-control-solid"
							formControlName="addressContract"
						>
							<option *ngFor="let province of stationAddress" [value]="province.id">
								{{ province.name }}
							</option>
						</select>
						<app-validate
							[control]="contractForm.controls['addressContract']"
							[error]="'required'"
							[message]="'Địa chỉ ký hợp đồng không được để trống'"
						></app-validate>
					</div>
				</div>

				<div class="form-group row">
					<div class="col-lg-8">
						<label class="form-label">Địa chỉ chi tiết</label>
						<input
							disabled
							class="form-control"
							maxlength="99"
							autocomplete="off"
							formControlName="fullAddress"
						/>
					</div>
				</div>
			</form>
		</div>
	</div>
	<div class="list-product" *ngIf="contractType === eContractType.PREPAID_CONTRACT">
		<div class="card-header">
			<div class="card-title">
				<h3 class="title">danh sách hàng hóa</h3>
			</div>
		</div>

		<div class="card-body">
			<div class="table-responsive angular-bootstrap-table">
				<form [formGroup]="productForm">
					<table class="table table-vertical-center overflow-hidden">
						<thead class="thead-light">
							<tr>
								<th>
									<label class="form-label">STT</label>
								</th>
								<th>
									<label class="form-label required">Loại sản phẩm</label>
								</th>
								<th>
									<label class="form-label required">Tên sản phẩm</label>
								</th>
								<th>
									<label class="form-label">Đơn vị</label>
								</th>
								<th>
									<label class="form-label required">Số lượng</label>
								</th>
								<th>
									<label class="form-label">Đơn giá hiện tại (VND)</label>
								</th>
								<th>
									<label class="form-label">Đơn giá chiết khấu (VND)</label>
								</th>
								<th>
									<label class="form-label">Thành tiền</label>
								</th>
								<th>
									<label class="form-label">Xóa</label>
								</th>
							</tr>
						</thead>

						<tbody>
							<ng-container formArrayName="products">
								<tr *ngFor="let productInfoFromGroup of productFormArray.controls; let i = index">
									<ng-container [formGroup]="productInfoFromGroup">
										<td>{{i + 1}}</td>
										<td>
											<select
												(change)="productTypeChanged($event, i)"
												class="form-control form-control-sm"
												formControlName="categoryProductId"
											>
												<option [value]="null">Chọn loại sản phẩm</option>
												<option *ngFor="let prodType of productTypes" [value]="prodType.id">
													{{prodType.name}}
												</option>
											</select>
											<app-validate
												[control]="productInfoFromGroup.get('categoryProductId')"
												[error]="'required'"
												[message]="'Loại sản phẩm được để trống'"
											></app-validate>
										</td>
										<td class="col2">
											<select
												(change)="productChanged($event, i)"
												class="form-control form-control-sm"
												formControlName="productId"
											>
												<option [value]="null">Chọn sản phẩm</option>
												<option *ngFor="let prod of products[i]" [value]="prod.id">
													{{prod.name}}
												</option>
											</select>
											<app-validate
												[control]="productInfoFromGroup.get('productId')"
												[error]="'required'"
												[message]="'Sản phẩm được để trống'"
											></app-validate>
										</td>
										<td class="col3" [textContent]="productInfoFromGroup.get('unit').value"></td>
										<td class="col4">
											<input
												(input)="changeAmount($event, i)"
												placeholder="Nhập số lượng"
												class="form-control form-control-sm"
												formControlName="amount"
												type="number"
												min="0"
											/>
											<app-validate
												[control]="productInfoFromGroup.get('amount')"
												[error]="'required'"
												[message]="'Số lượng được để trống'"
											></app-validate>
										</td>
										<td class="col5" [textContent]="productInfoFromGroup.get('price').value"></td>
										<td class="col6"></td>
										<td
											class="col7"
											[textContent]="productInfoFromGroup.get('totalMoney').value | number | vnCurrency"
										></td>
										<td class="col8">
											<a
												*ngIf="i > 0"
												(click)="deleteProduct(i)"
												class="btn btn-icon btn-light btn-hover-danger btn-sm"
											>
												<span
													[inlineSVG]="'./assets/media/svg/icons/General/Trash.svg'"
													cacheSVG="true"
													class="svg-icon svg-icon-md svg-icon-danger"
													[ngbTooltip]="'Xóa'"
												>
												</span>
											</a>
										</td>
									</ng-container></tr
							></ng-container>
						</tbody>

						<tfoot>
							<tr>
								<td>
									<a
										*ngIf="productFormArray.length < 5"
										(click)="addProduct()"
										class="btn btn-icon btn-light btn-hover-primary btn-sm"
									>
										<span
											[inlineSVG]="'./assets/media/svg/icons/Code/Plus.svg'"
											cacheSVG="true"
											class="svg-icon svg-icon-md svg-icon-primary"
											[ngbTooltip]="'Thêm'"
										>
										</span>
									</a>
								</td>
								<td colspan="4"></td>
								<td colspan="2">Tổng tiền thanh toán</td>
								<td [textContent]="getTotal() | number | vnCurrency"></td>
								<td></td>
							</tr>
						</tfoot>
					</table>
				</form>
			</div>
		</div>
	</div>

	<div class="upload-file">
		<div class="card-header">
			<div class="card-title">
				<h3 class="title">Thông tin hồ sơ</h3>
			</div>
		</div>

		<div class="card-body">
			<div class="form-group row">
				<div class="col-lg-2">File đính kèm</div>
				<div class="col-lg-10 row">
					<div class="col-lg-12">
						<button type="button" class="btn btn-outline-primary mr-3">Đính kèm file</button>
						<button type="button" class="btn btn-outline-primary ml-3">Xóa tất cả</button>
					</div>
					<div class="col-lg-12"></div>
				</div>
			</div>
		</div>
	</div>

	<div class="w-100 d-flex justify-content-center pb-10">
		<button type="button" class="btn btn-outline-secondary font-weight-bold m-2">Lưu nháp</button>
		<button class="btn btn-primary font-weight-bold m-2" type="button">Gửi duyệt</button>
	</div>
</div>
