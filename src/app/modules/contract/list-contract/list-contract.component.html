<div class="card card-custom gutter-b mt-1">
	<div class="card-header">
		<div class="card-title">
			<h3 class="card-label">Danh sách hợp đồng</h3>
		</div>

		<div class="card-toolbar row">
			<div class="search-form">
				<em class="flaticon-search"></em>
				<input
					type="text"
					name="searchText"
					placeholder="Search..."
					class="form-control"
					[formControl]="searchFormControl"
				/>
			</div>
			<button
				type="button"
				class="btn btn-primary"
				(click)="createContract()"
				*ngIf="(eAuthorize.CREATE_CONTRACT_BUTTON|canUseFeature) || (eAuthorize.CREATE_CONTRACT_PLAN_BUTTON|canUseFeature)"
			>
				Thêm mới
			</button>
		</div>
	</div>
	<div class="card-body">
		<div class="table-responsive angular-bootstrap-table">
			<table class="table table-head-custom table-vertical-center overflow-hidden" aria-label="">
				<thead>
					<th scope="">
						Mã hợp đồng
						<app-sort-icon
							column="code"
							[activeColumn]="sortData?.fieldSort"
							[activeDirection]="sortData?.directionSort"
							(sort)="sort($event)"
						></app-sort-icon>
					</th>
					<th scope="">
						Tên hợp đồng
						<app-sort-icon
							column="name"
							[activeColumn]="sortData?.fieldSort"
							[activeDirection]="sortData?.directionSort"
							(sort)="sort($event)"
						></app-sort-icon>
					</th>
					<th scope="">
						Loại hợp đồng
						<app-sort-icon
							column="contract_type"
							[activeColumn]="sortData?.fieldSort"
							[activeDirection]="sortData?.directionSort"
							(sort)="sort($event)"
						></app-sort-icon>
					</th>
					<th scope="">
						Ngày tạo
						<app-sort-icon
							column="created_at"
							[activeColumn]="sortData?.fieldSort"
							[activeDirection]="sortData?.directionSort"
							(sort)="sort($event)"
						></app-sort-icon>
					</th>
					<th scope="">
						Ngày hết hạn
						<app-sort-icon
							column="effect_end_date"
							[activeColumn]="sortData?.fieldSort"
							[activeDirection]="sortData?.directionSort"
							(sort)="sort($event)"
						></app-sort-icon>
					</th>
					<th scope="">Trạng thái</th>
					<th class="text-center" scope="">Tác động</th>
				</thead>
				<tbody>
					<tr *ngFor="let item of dataSource" (click)="viewDetalContract(item)">
						<td class="code">
							<p class="cursor-pointer text-ellipsis" placement="top" [ngbTooltip]="item.code">
								{{ item.code }}
							</p>
						</td>

						<td class="name">
							<p class="cursor-pointer text-ellipsis" placement="top" [ngbTooltip]="item.name">
								{{ item.name }}
							</p>
						</td>

						<td class="contractType">
							<p
								class="cursor-pointer text-ellipsis"
								placement="top"
								[ngbTooltip]="item.contractType.name"
							>
								{{ item.contractType.name }}
							</p>
						</td>
						<td class="createAt">
							<p
								class="cursor-pointer text-ellipsis"
								placement="top"
								[ngbTooltip]="item.createdAt | date: 'dd/MM/yyyy'"
							>
								{{ item.createdAt | date: 'dd/MM/yyyy' }}
							</p>
						</td>
						<td class="effectEndDate">
							<p
								class="cursor-pointer text-ellipsis"
								placement="top"
								[ngbTooltip]="item.effectEndDate | date: 'dd/MM/yyyy'"
							>
								{{ item.effectEndDate | date: 'dd/MM/yyyy' }}
							</p>
						</td>

						<td class="status">
							<span
								class="label label-lg label-inline"
								[class.label-light-success]="item.status === contractStatus.ACCEPTED"
								[class.label-light-danger]="item.status === contractStatus.REJECT"
								[class.label-light-warning]="item.status === contractStatus.WAITING_ACCEPT"
								[class.label-light-primary]="item.status === contractStatus.DRAFT"
							>
								<ng-container *ngIf="item.status === contractStatus.ACCEPTED"
									>Đã duyệt</ng-container
								>
								<ng-container *ngIf="item.status === contractStatus.REJECT"
									>Đã từ chối</ng-container
								>
								<ng-container *ngIf="item.status === contractStatus.WAITING_ACCEPT"
									>Chờ phê duyệt</ng-container
								>
								<ng-container *ngIf="item.status === contractStatus.DRAFT">Lưu nháp</ng-container>
							</span>
						</td>
						<td class="action">
							<a
								*ngIf="item.status === contractStatus.DRAFT && ((item.contractType.code === 'PRE_PAY' && (eAuthorize.UPDATE_CONTRACT_BUTTON|canUseFeature)) || (item.contractType.code === 'PLAN' && (eAuthorize.UPDATE_CONTRACT_PLAN_BUTTON|canUseFeature)))"
								(click)="updateContract($event,item.id)"
								class="btn btn-icon btn-light btn-hover-primary btn-sm mx-1"
								[ngbTooltip]="'Sửa'"
							>
								<span
									[inlineSVG]="'./assets/media/svg/icons/Communication/Write.svg'"
									cacheSVG="true"
									class="svg-icon svg-icon-md svg-icon-primary"
								>
								</span>
							</a>
							<a
								*ngIf="item.status === contractStatus.DRAFT && (eAuthorize.DELETE_CONTRACT_BUTTON|canUseFeature)"
								(click)="deleteContract($event, item)"
								class="btn btn-icon btn-light btn-hover-danger btn-sm mx-1"
								[ngbTooltip]="'Xóa'"
							>
								<span
									[inlineSVG]="'./assets/media/svg/icons/General/Trash.svg'"
									cacheSVG="true"
									class="svg-icon svg-icon-md svg-icon-danger"
								>
								</span>
							</a>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
		<app-paginator [paginator]="paginatorState" (paginate)="pagingChange($event)"></app-paginator>
	</div>
</div>
