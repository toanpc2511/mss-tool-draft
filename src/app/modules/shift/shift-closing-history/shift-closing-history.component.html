<div class="card card-custom gutter-b mt-1">
	<div class="card-header">
		<div class="card-title">
			<h3 class="card-label">Tìm kiếm lịch sử chốt ca</h3>
		</div>
	</div>
	<div class="card-body">
		<form [formGroup]="searchForm" class="form form-label-right">
			<div class="form-group row">
				<div class="col-lg-6">
					<label>Tên trạm</label>
					<select class="form-control form-control-solid w-75" formControlName="stationName">
						<option [value]="''">Tất cả</option>
						<option *ngFor="let item of listStations" [value]="item.name">{{item.name}}</option>
					</select>
				</div>

				<div class="col-lg-6">
					<label>Ca làm việc</label>
					<select class="form-control form-control-solid w-75" formControlName="shiftName">
						<option [value]="''">Tất cả</option>
						<option *ngFor="let item of listShifts" [value]="item.name">{{item.name}}</option>
					</select>
				</div>
			</div>

			<div class="form-group row">
				<div class="col-lg-6">
					<label>Ngày bắt đầu từ</label>

					<div class="input-group w-75">
						<input
							class="form-control form-control-solid"
							placeholder="DD/MM/YYYY"
							ngbDatepicker
							#startAt="ngbDatepicker"
							formControlName="startAt"
						/>
						<div class="input-group-append">
							<button
								class="btn btn-outline-secondary fa fa-calendar-alt"
								(click)="startAt.toggle()"
								type="button"
							></button>
						</div>
					</div>
					<app-validate
						[control]="searchForm.get('startAt')"
						[error]="'errorDateStart'"
						[message]="'Thời gian từ ngày không lớn hơn thời gian đến ngày'"
					></app-validate>

          <app-validate
            [control]="searchForm.controls['startAt']"
            [error]="'ngbDate'"
            [message]="'Ngày bắt đầu không đúng định dạng'"
          ></app-validate>
				</div>

				<div class="col-lg-6">
					<label>Đến</label>

					<div class="input-group w-75">
						<input
							class="form-control form-control-solid"
							placeholder="DD/MM/YYYY"
							ngbDatepicker
							#endAt="ngbDatepicker"
							formControlName="endAt"
						/>
						<div class="input-group-append">
							<button
								class="btn btn-outline-secondary fa fa-calendar-alt"
								(click)="endAt.toggle()"
								type="button"
							></button>
						</div>
					</div>
					<app-validate
						[control]="searchForm.get('endAt')"
						[error]="'errorDateEnd'"
						[message]="'Thời gian đến ngày không nhỏ hơn thời gian từ ngày'"
					></app-validate>

          <app-validate
            [control]="searchForm.controls['endAt']"
            [error]="'ngbDate'"
            [message]="'Đến ngày không đúng định dạng'"
          ></app-validate>
				</div>
			</div>
		</form>

		<div class="form-group row pt-3">
			<button type="button" class="btn btn-primary btn-def" (click)="onSearch()">
				<em class="fas fa-search"></em> Tìm kiếm
			</button>
		</div>
	</div>
</div>

<div class="card card-custom gutter-b mt-1">
	<div class="card-header">
		<div class="card-title">
			<h3 class="card-label">Danh sách lịch sử chốt ca</h3>
		</div>
	</div>

	<div class="card-body">
		<div class="table-responsive angular-bootstrap-table">
			<table class="table table-head-custom table-vertical-center overflow-hidden" aria-label="">
				<thead>
					<th scope="">Tên trạm</th>
					<th scope="">Tên ca</th>
					<th scope="">Thời gian bắt đầu</th>
					<th scope="">Thời gian kết thúc</th>
					<th scope="">Trạng thái</th>
					<th scope="" class="text-center">Tác động</th>
				</thead>

				<tbody>
					<tr
						*ngFor="let item of dataSource"
						(click)="viewDetail(item)"
					>
						<td class="station-name">
							<p
								class="cursor-pointer text-ellipsis"
								placement="top"
								[ngbTooltip]="item.stationName"
							>
								{{ item.stationName }}
							</p>
						</td>
						<td class="shift-name">
							<p class="cursor-pointer text-ellipsis" placement="top" [ngbTooltip]="item.shiftName">
								{{ item.shiftName }}
							</p>
						</td>
						<td class="time-start">
							<p
								class="cursor-pointer text-ellipsis"
								placement="top"
								[ngbTooltip]="item.timeStart | date: 'dd/MM/yyyy' + ' - ' + formatTime(item.startHour, item.startMinute)"
							>
								{{item.timeStart | date: 'dd/MM/yyyy'}} - {{ formatTime(item.startHour,
								item.startMinute) }}
							</p>
						</td>
						<td class="time-end">
							<p
                *ngIf='item.timeEnd'
								class="cursor-pointer text-ellipsis"
								placement="top"
								[ngbTooltip]="item.timeEnd | date: 'dd/MM/yyyy' + ' - ' + formatTime(item.endHour, item.endMinute)"
							>
								{{item.timeEnd | date: 'dd/MM/yyyy'}} - {{ formatTime(item.endHour, item.endMinute)
								}}
							</p>
						</td>
						<td class="status">
							<span
								class="label label-lg label-inline"
								[class.label-light-success]="item.status === listStatus.OPEN"
								[class.label-light-danger]="item.status === listStatus.CLOSE"
								[class.label-light-warning]="item.status === listStatus.PENDING"
							>
								<ng-container *ngIf="item.status === listStatus.OPEN">Mở</ng-container>
								<ng-container *ngIf="item.status === listStatus.CLOSE">Đóng</ng-container>
								<ng-container *ngIf="item.status === listStatus.PENDING">Chờ chốt ca</ng-container>
							</span>
						</td>
						<td class="text-center action">
							<button
								type="button"
								class="btn btn-primary"
								*ngIf='item.status === "OPEN" && eAuthorize.CONFIRMED_REQUEST_LOCK_SHIFT | canUseFeature'
								(click)="modalConfirm($event, item)"
							>
								Yêu cầu chốt ca
							</button>
						</td>
					</tr>
				</tbody>

				<tfoot *ngIf="dataSource?.length === 0">
					<tr>
						<td colspan="13" class="text-center" style="color: #ccc">Không có bản ghi nào</td>
					</tr>
				</tfoot>
			</table>
		</div>
		<app-paginator [paginator]="paginatorState" (paginate)="pagingChange($event)"></app-paginator>
	</div>
</div>
