<div class="card card-custom gutter-b mt-1">
  <form [formGroup]='importInventoryDetailForm'>
    <div class="info-request pb-0 mt-2">
      <div class="card-header">
        <div class="card-title my-5">
          <h3 class="title">Mã phiếu nhập: {{ dataSource?.code }}</h3>
        </div>
      </div>
    </div>

    <div class="pb-5">
      <div class="card-header">
        <div class="card-title">
          <h3 class="title">Thông tin bên nhận hàng</h3>
        </div>
      </div>

      <div class="card-body">
        <div class="form-group row">
          <div class="col-lg-6 row">
            <div class="col-lg-5">
              <label class="form-label">Người đại diện</label>
            </div>

            <div class="col-lg-7">
              <label class="form-label font-weight-bold">{{ dataSource?.representativeTakeName }}</label>
            </div>
          </div>

          <div class="col-lg-6 row">
            <div class="col-lg-5">
              <label class="form-label">Bên nhận hàng</label>
            </div>

            <div class="col-lg-7">
              <label class="form-label font-weight-bold">{{ dataSource?.importedWarehouseName }}</label>
            </div>
          </div>
        </div>

        <div class="form-group row">
          <div class="col-lg-6 row">
            <div class="col-lg-5">
              <label class="form-label">Địa chỉ</label>
            </div>

            <div class="col-lg-7">
              <label class="form-label font-weight-bold">{{ dataSource?.importedWarehouseAddress }}</label>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="pb-5">
      <div class="card-header">
        <div class="card-title">
          <h3 class="title">Thông tin bên giao hàng</h3>
        </div>
      </div>

      <div class="card-body">
        <div class="form-group row">
          <div class="col-lg-6 row align-items-center">
            <div class="col-lg-5">
              <label class="form-label">Người đại diện</label>
            </div>

            <div class="col-lg-7" *ngIf='!status || status && dataSource?.carMethod !== "SUPPLIER"'>
                <label class="form-label font-weight-bold">{{ dataSource?.driver.name }}</label>
            </div>

              <div *ngIf='status && dataSource?.carMethod === "SUPPLIER"' class="col-lg-7">
                  <input
                    class="form-control"
                    formControlName='nameDriver'
                    placeholder='Nhập tên người đại diện'
                  />
                  <app-validate
                    [control]="importInventoryDetailForm.controls['nameDriver']"
                    [error]="'required'"
                    [message]="'Người đại diện không được để trống'"
                  ></app-validate>
              </div>
          </div>

          <div class="col-lg-6 row">
            <div class="col-lg-5">
              <label class="form-label">Bên giao hàng</label>
            </div>

            <div class="col-lg-7">
              <label class="form-label font-weight-bold">{{ dataSource?.exportedWarehouseName }}</label>
            </div>
          </div>
        </div>

        <div class="form-group row">
          <div class="col-lg-6 row">
            <div class="col-lg-5">
              <label class="form-label">Địa chỉ</label>
            </div>

            <div class="col-lg-7">
              <label class="form-label font-weight-bold">{{ dataSource?.exportedWarehouseAddress }}</label>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="pb-5">
      <div class="card-header">
        <div class="card-title">
          <h3 class="title">Thông tin lái xe</h3>
        </div>
      </div>

      <div class="card-body">
        <div class="form-group row">
          <div class="col-lg-6 row align-items-center">
            <div class="col-lg-5">
              <label class="form-label">Tên lái xe</label>
            </div>

            <div class="col-lg-7" *ngIf='!status || status && dataSource?.carMethod !== "SUPPLIER"'>
              <label class="form-label font-weight-bold">{{ dataSource?.driver.name }}</label>
            </div>

              <div *ngIf='status && dataSource?.carMethod === "SUPPLIER"' class="col-lg-7">
                  <input
                    class="form-control"
                    [disabled]='true'
                    placeholder='Tên người lái xe'
                    [value]='importInventoryDetailForm.controls["nameDriver"].value'
                  />
              </div>
          </div>

          <div class="col-lg-6 row align-items-center">
            <div class="col-lg-5">
              <label class="form-label">Biển kiểm soát</label>
            </div>

            <div class="col-lg-7" *ngIf='!status || status && dataSource?.carMethod !== "SUPPLIER"'>
              <label class="form-label font-weight-bold">{{ dataSource?.licensePlates }}</label>
            </div>

              <div *ngIf='status && dataSource?.carMethod === "SUPPLIER"' class="col-lg-7">
                  <input
                    class="form-control"
                    formControlName='licensePlates'
                    placeholder='Nhập biển kiểm soát'
                  />
                  <app-validate
                    [control]="importInventoryDetailForm.controls['licensePlates']"
                    [error]="'required'"
                    [message]="'Biển kiểm soát không được để trống'"
                  ></app-validate>
              </div>
          </div>
        </div>
      </div>
    </div>
  </form>

  <div class="list-product py-5">
    <div class="card-header">
      <div class="card-title">
        <h3 class="title">Danh sách hàng hóa</h3>
      </div>
    </div>

    <div class="card-body">
      <div class="table-responsive angular-bootstrap-table">
        <table class="table table-head-custom table-vertical-center overflow-hidden" aria-label="">
          <thead>
          <tr>
            <th scope=''>STT</th>
            <th scope='' class='product-name'>Tên sản phẩm</th>
            <th scope='' class='unit'>Đơn vị</th>
            <th scope='' class='provider'>Nguồn hàng</th>
            <th scope='' class='compartment'>Ngăn</th>
            <th scope='' class='amount-actually'>Số lượng</th>
            <th scope='' class='gas-field-out-name'>Bồn xuất</th>
            <th scope='' class='gas-field-in-name'>Bồn nhập</th>
            <th scope='' class='temperature-export form-label' [class.text-right]='!status'>Nhiệt độ thực tế tại kho xuất (độ C)</th>
            <th scope='' class='quota-export text-right form-label' [class.text-right]='!status'>Tâm mức thực Kho xuất (cm)</th>
            <th scope='' class='cap-lead text-right form-label' [class.text-right]='!status'>Số chì nắp</th>
            <th scope='' class='cap-valve text-right form-label' [class.text-right]='!status'>Số chì van</th>
            <th scope='' class='temperature-import text-right form-label' [class.text-right]='!status'>Nhiệt độ thực tế tại kho nhập (độ C)</th>
            <th scope='' class='quota-import text-right form-label' [class.text-right]='!status'>Tâm mức thực Kho nhập (cm)</th>
            <th scope='' class='' [class.text-right]='!status'>Âm dương</th>
          </tr>
          </thead>

          <tbody *ngIf='status; else completelyTpl'>
          <tr *ngFor="let item of importProductInfos?.controls; let i = index">
            <ng-container [formGroup]='item'>
              <td class='stt'>{{i + 1}}</td>
              <td class='product-name'>
                <p
                  class="cursor-pointer text-ellipsis"
                  placement="top"
                  [ngbTooltip]="item.get('productName').value"
                >
                  {{ item.get('productName').value }}
                </p>
              </td>
              <td class='unit'>
                <p
                  class="cursor-pointer text-ellipsis"
                  placement="top"
                  [ngbTooltip]="item.get('unit').value"
                >
                  {{ item.get('unit').value }}
                </p>
              </td>
              <td class='provider'>
                <p
                  class="cursor-pointer text-ellipsis"
                  placement="top"
                  [ngbTooltip]="item.get('supplierName').value"
                >
                  {{ item.get('supplierName').value }}
                </p>
              </td>
              <td class="compartment">
                <input
                  class="form-control"
                  formControlName='compartment'
                  autocomplete="off"
                  trim="blur"
                  placeholder='Nhập ngăn'
                />
              </td>
              <td class="amount-actually">
                <p
                  class="cursor-pointer text-right"
                  placement="top"
                  [ngbTooltip]="item.get('amountActually').value | number | vnCurrency"
                >
                  {{ item.get('amountActually').value | number | vnCurrency }}
                </p>
              </td>
              <td class="gas-field-out-name">
                <p
                  class="cursor-pointer text-ellipsis"
                  placement="top"
                  [ngbTooltip]="item.get('gasFieldOutName').value"
                >
                  {{ item.get('gasFieldOutName').value }}
                </p>
              </td>
              <td class="gas-field-in-name">
                <p
                  class="cursor-pointer text-ellipsis"
                  placement="top"
                  [ngbTooltip]="item.get('gasFieldInName').value"
                >
                  {{ item.get('gasFieldInName').value }}
                </p>
              </td>
              <td class="temperature-export">
                <input
                  class="form-control"
                  formControlName='temperatureExport'
                  maxlength='10'
                  (keydown.space)="$event.preventDefault()"
                  (keydown)='preventLetter($event)'
                  placeholder='Nhập nhiệt độ thực tế tại kho xuất'
                />
                <app-validate
                  [control]="item.get('temperatureExport')"
                  [error]="'required'"
                  [message]="'Nhiệt độ thực tế tại kho xuất không được để trống'"
                ></app-validate>
                <app-validate
                  [control]="item.get('temperatureExport')"
                  [error]="'pattern'"
                  [message]="'Sai định dạng'"
                ></app-validate>
              </td>
              <td class="quota-export">
                <input
                  class="form-control"
                  formControlName='quotaExport'
                  maxlength='10'
                  (keydown.space)="$event.preventDefault()"
                  (keydown)='preventLetter($event)'
                  placeholder='Nhập tâm mức thực tế tại kho xuất'
                />
                <app-validate
                  [control]="item.get('quotaExport')"
                  [error]="'required'"
                  [message]="'Tâm mức thực tế tại kho xuất không được để trống'"
                ></app-validate>
                <app-validate
                  [control]="item.get('quotaExport')"
                  [error]="'pattern'"
                  [message]="'Sai định dạng'"
                ></app-validate>
              </td>
              <td class="cap-lead">
                <input
                  class="form-control"
                  formControlName='capLead'
                  autocomplete="off"
                  maxlength='10'
                  trim="blur"
                  (keydown.space)="$event.preventDefault()"
                  placeholder='Nhập số chì nắp'
                />
                <app-validate
                  [control]="item.get('capLead')"
                  [error]="'required'"
                  [message]="'Số chì nắp không được để trống'"
                ></app-validate>
              </td>
              <td class="cap-valve">
                <input
                  class="form-control"
                  formControlName='capValve'
                  autocomplete="off"
                  maxlength='10'
                  trim="blur"
                  placeholder='Nhập số chì van'
                />
                <app-validate
                  [control]="item.get('capValve')"
                  [error]="'required'"
                  [message]="'Số chì van không được để trống'"
                ></app-validate>
              </td>
              <td class="temperature-import">
                <input
                  class="form-control"
                  formControlName='temperatureImport'
                  autocomplete="off"
                  maxlength='10'
                  (keydown.space)="$event.preventDefault()"
                  (keydown)='preventLetter($event)'
                  placeholder='Nhập nhiệt độ thực tế tại kho nhập'
                />
                <app-validate
                  [control]="item.get('temperatureImport')"
                  [error]="'pattern'"
                  [message]="'Sai định dạng'"
                ></app-validate>
                <app-validate
                  [control]="item.get('temperatureImport')"
                  [error]="'required'"
                  [message]="'Nhiệt độ thực tế tại kho nhập không được để trống'"
                ></app-validate>
              </td>
              <td class="quota-import">
                <input
                  class="form-control"
                  formControlName='quotaImport'
                  autocomplete="off"
                  maxlength='10'
                  trim="blur"
                  (keydown.space)="$event.preventDefault()"
                  (keydown)='preventLetter($event)'
                  placeholder='Nhập tâm mực thực tại kho nhập'
                />
                <app-validate
                  [control]="item.get('quotaImport')"
                  [error]="'required'"
                  [message]="'Tâm mức thực tại kho nhập không được để trống'"
                ></app-validate>
                <app-validate
                  [control]="item.get('quotaImport')"
                  [error]="'pattern'"
                  [message]="'Sai định dạng'"
                ></app-validate>
              </td>
              <td class="difference">
                <input
                  class="form-control"
                  formControlName='difference'
                  autocomplete="off"
                  maxlength='10'
                  trim="blur"
                  (keydown.space)="$event.preventDefault()"
                  (keydown)='preventLetter($event)'
                  placeholder='Nhập âm dương'
                />
                <app-validate
                  [control]="item.get('difference')"
                  [error]="'required'"
                  [message]="'Âm dương không được để trống'"
                ></app-validate>
              </td>
            </ng-container>
          </tr>
          </tbody>

          <ng-template #completelyTpl>
            <tr *ngFor="let item of importProductInfos?.controls; let i = index">
              <ng-container [formGroup]='item'>
                <td class='stt'>{{i + 1}}</td>
                <td class='product-name'>
                  <p
                    class="cursor-pointer text-ellipsis"
                    placement="top"
                    [ngbTooltip]="item.get('productName').value"
                  >
                    {{ item.get('productName').value }}
                  </p>
                </td>
                <td class='unit'>
                  <p
                    class="cursor-pointer text-ellipsis"
                    placement="top"
                    [ngbTooltip]="item.get('unit').value"
                  >
                    {{ item.get('unit').value }}
                  </p>
                </td>
                <td class='provider'>
                  <p
                    class="cursor-pointer text-ellipsis"
                    placement="top"
                    [ngbTooltip]="item.get('supplierName').value"
                  >
                    {{ item.get('supplierName').value }}
                  </p>
                </td>
                <td class="compartment">
                  <p
                    class="cursor-pointer text-ellipsis"
                    placement="top"
                    [ngbTooltip]="item.get('compartment').value"
                  >
                    {{ item.get('compartment').value }}
                  </p>
                </td>
                <td class="amount-actually text-right">
                  <p
                    class="cursor-pointer text-right"
                    placement="top"
                    [ngbTooltip]="item.get('amountActually').value | number | vnCurrency"
                  >
                    {{ item.get('amountActually').value | number | vnCurrency }}
                  </p>
                </td>
                <td class="gas-field-out-name">
                  <p
                    class="cursor-pointer text-ellipsis"
                    placement="top"
                    [ngbTooltip]="item.get('gasFieldOutName').value"
                  >
                    {{ item.get('gasFieldOutName').value }}
                  </p>
                </td>
                <td class="gas-field-in-name">
                  <p
                    class="cursor-pointer text-ellipsis"
                    placement="top"
                    [ngbTooltip]="item.get('gasFieldInName').value"
                  >
                    {{ item.get('gasFieldInName').value }}
                  </p>
                </td>
                <td class="temperature-export text-right">
                  <p
                    class="cursor-pointer text-ellipsis"
                    placement="top"
                    [ngbTooltip]="item.get('temperatureExport').value"
                  >
                    {{ item.get('temperatureExport').value }}
                  </p>
                </td>
                <td class="quota-export text-right">
                  <p
                    class="cursor-pointer text-ellipsis"
                    placement="top"
                    [ngbTooltip]="item.get('quotaExport').value"
                  >
                    {{ item.get('quotaExport').value }}
                  </p>
                </td>
                <td class="cap-lead text-right">
                  <p
                    class="cursor-pointer text-ellipsis"
                    placement="top"
                    [ngbTooltip]="item.get('capLead').value"
                  >
                    {{ item.get('capLead').value }}
                  </p>
                </td>
                <td class="cap-valve text-right">
                  <p
                    class="cursor-pointer text-ellipsis"
                    placement="top"
                    [ngbTooltip]="item.get('capValve').value"
                  >
                    {{ item.get('capValve').value }}
                  </p>
                </td>
                <td class="temperature-import text-right">
                  <p
                    class="cursor-pointer text-ellipsis"
                    placement="top"
                    [ngbTooltip]="item.get('temperatureImport').value"
                  >
                    {{ item.get('temperatureImport').value }}
                  </p>
                </td>
                <td class="quota-import text-right">
                  <p
                    class="cursor-pointer text-ellipsis"
                    placement="top"
                    [ngbTooltip]="item.get('quotaImport').value"
                  >
                    {{ item.get('quotaImport').value }}
                  </p>
                </td>
                <td class="difference text-right">
                  <p
                    class="cursor-pointer text-ellipsis"
                    placement="top"
                    [ngbTooltip]="item.get('difference').value"
                  >
                    {{ item.get('difference').value }}
                  </p>
                </td>
              </ng-container>
            </tr>
          </ng-template>

          <tfoot *ngIf="dataSource?.wareHouseOrderProductResponses?.length === 0">
          <tr>
            <td colspan="10" class="text-center" style="color: #ccc">Không có bản ghi nào</td>
          </tr>
          </tfoot>
        </table>
      </div>
    </div>
  </div>

  <div class="py-10 w-100 d-flex justify-content-center">
    <button *ngIf='status && eAuthorize.COMPLETE_WAREHOUSE_IMPORT_BUTTON | canUseFeature'
      class="btn btn-primary mr-3 button"
      (click)='submit()'
    >
      Hoàn thành
    </button>
    <button
      *ngIf='!status && eAuthorize.EXPORT_FILE_WORD_WAREHOUSE_IMPORT'
      class="btn btn-primary mr-3 button"
      (click)='exportFile()'
    >
      In phiếu nhập
    </button>
  </div>
</div>
