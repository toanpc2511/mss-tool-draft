<ng-template #error let-controlName="controlName" let-controlNameVi="controlNameVi">
  <div *ngIf="form.controls[controlName].invalid &&
                           (form.controls[controlName].dirty || form.controls[controlName].touched)">
    <ng-container [ngSwitch]="getFirstError(controlName)">
      <span *ngSwitchCase="FORM_VAL_ERRORS.REQUIRED" class="text-danger mt-1 d-block small">
        <span *ngIf="controlName === 'recipientFullName'">
          Thông tin người nhận không hợp lệ
        </span>
        <span *ngIf="controlName !== 'recipientFullName'">
          {{controlNameVi}} không được bỏ trống
        </span>
      </span>
      <span *ngSwitchCase="FORM_VAL_ERRORS.NO_EXIST" class="text-danger mt-1 d-block small">
        {{controlNameVi}} không {{controlName === 'employeeId' ? 'tồn tại' : 'hợp lệ'}}
      </span>
    </ng-container>
  </div>
</ng-template>

<app-external-transfer-form [formGroup]="form" [disabledForm]="disabledForm" [lstProduct]="lstProduct"
  #externalTransferForm [transferType]="'NAPAS'">
  <div area="productForm">
    <!-- #region Product Form -->
    <div class="row">
      <div class="col col-lg-3 col-md-6 col-sm-12">
        <!-- #region Mã sản phẩm (*) -->
        <div class="form-group row">
          <span class="col-lg-12 col-form-label textLabel">Mã sản phẩm <span class="text-danger">(*)</span></span>
          <span class="col-lg-12">
            <app-lpb-select-tooltip
               [bindValue]="'code'" [placeholder]="'Chọn mã sản phẩm'" [items]="lstProduct"
               [optPatternFields]="['code', 'name']" [optPatternSplitter]="'-'"
               [control]="form.controls['productCode']"
            ></app-lpb-select-tooltip>
            <ng-container
              *ngTemplateOutlet="error; context: {controlName: 'productCode', controlNameVi: 'Mã sản phẩm'}">
            </ng-container>
          </span>
        </div>
        <!--#endregion -->
      </div>

      <div class="col col-lg-3 col-md-6 col-sm-12">
        <!-- #region Số tài khoản trung gian (*) -->
        <div class="form-group row">
          <span class="col-lg-12 col-form-label textLabel">Số tài khoản trung gian</span>
          <span class="col-lg-12">
            <input type="text" formControlName="intermediaryAcn" class="form-control">
          </span>
        </div>
        <!--#endregion -->
      </div>

      <div class="col col-lg-3 col-md-6 col-sm-12">
        <!-- #region Tên tài khoản trung gian (*) -->
        <div class="form-group row" [title]="form.controls['intermediaryAcnName'].value">
          <span class="col-lg-12 col-form-label textLabel">Tên tài khoản trung gian</span>
          <span class="col-lg-12">
            <input type="text" formControlName="intermediaryAcnName" class="form-control">
          </span>
        </div>
        <!--#endregion -->
      </div>

      <div class="col col-lg-3 col-md-6 col-sm-12">
        <!--#region Mã nhân viên (*) -->
        <div class="form-group row">
          <span class="col-lg-12 col-form-label textLabel">Mã nhân viên <span class="text-danger">(*)</span></span>
          <span class="col-lg-12">
            <app-lpb-employee-input [control]="form.controls['employeeId']" [serviceName]="'transfer-service'"></app-lpb-employee-input>
            <ng-container
              *ngTemplateOutlet="error; context: {controlName: 'employeeId', controlNameVi: 'Mã nhân viên'}">
            </ng-container>
          </span>
        </div>
        <!--#endregion -->
      </div>
    </div>
    <!--#endregion -->
  </div>

  <div area="recipientForm">
     <!-- #region Phương thưc nhận tiền (*) -->
    <div class="form-group row">
      <div class="col col-lg-12">
        <div class="form-radio-inline-group d-flex align-items-start">
          <label class="txtLabel form-radio-inline d-flex align-items-center">
            <input class="form-control" formControlName="recipientTxtType" name="recipientTxtType" type="radio"
              [value]="NAPAS_SEARCH_TYPES.ACN"  (change)="changeSearchType(NAPAS_SEARCH_TYPES.ACN)">
            Số tài khoản
          </label>
          <label class="txtLabel form-radio-inline d-flex align-items-center">
            <input class="form-control" formControlName="recipientTxtType" name="recipientTxtType" type="radio"
              [value]="NAPAS_SEARCH_TYPES.CARD_NO" (change)="changeSearchType(NAPAS_SEARCH_TYPES.CARD_NO)">
            Số thẻ
          </label>
        </div>
      </div>
      <div class="col col-lg-12"></div>
    </div>
    <!--#endregion -->

    <div class="form-group row">
      <div class="col col-lg-12">
        <div class="check-rep-info">
          <ng-template #acn>
            <div class="input-wrapper">
              <input type="text" formControlName="recipientAcn" class="form-control" [textPattern]="{allowRegex: '[0-9]'}" maxlength="20"
                (input)="changeTextSearch($event)" trimInput>
              <ng-container *ngTemplateOutlet="error; context: {controlName: 'recipientAcn', controlNameVi: 'Số tài khoản' }">
              </ng-container>
            </div>
          </ng-template>
          <ng-template #cardNum>
            <div class="input-wrapper">
              <input type="text" formControlName="recipientCardNum" class="form-control" [textPattern]="{allowRegex: '[0-9]'}" maxlength="20"
                (input)="changeTextSearch($event)" trimInput>
              <ng-container *ngTemplateOutlet="error; context: {controlName: 'recipientCardNum', controlNameVi: 'Số thẻ' }">
              </ng-container>
            </div>
          </ng-template>

          <div class="input-wrapper" *ngIf="form.controls['recipientTxtType'].value === 'ACN'; then acn; else cardNum">
          </div>
          <div>
            <button mat-raised-button color="primary" [disabled]="!enabledBtn" (click)="searchInfo()">
              Check
            </button>
          </div>
          <div class="tooltip-wrapper">
            <mat-icon [matTooltip]="matTooltip" matTooltipClass="tooltip-info">info</mat-icon>
          </div>
        </div>
      </div>
    </div>

    <!-- #region Ngân hàng(*) -->
    <div class="form-group row">
      <span class="col-lg-12 col-form-label textLabel">Ngân hàng <span class="text-danger">(*)</span></span>
      <span class="col-lg-12">
        <div *ngIf="form.controls['recipientTxtType'].value === 'ACN'; then select; else txtField"></div>
        <ng-template #select>
          <app-lpb-select-tooltip
               [bindValue]="'benId'" [placeholder]="'Chọn ngân hàng'" [items]="lstBank"
               [optPatternFields]="['benId', 'bankName']" [optPatternSplitter]="'-'"
               [control]="form.controls['recipientBankId']" (change)="changeBank($event)"
          ></app-lpb-select-tooltip>
          <ng-container
            *ngTemplateOutlet="error; context: {controlName: 'recipientBankId', controlNameVi: 'Ngân hàng'}">
          </ng-container>
        </ng-template>

        <ng-template #txtField>
          <input type="text" [value]="recipientBankName" class="form-control" disabled
            [class.input-error]="form.controls['recipientBankName'].invalid && form.controls['recipientBankName'].touched">
          <ng-container
            *ngTemplateOutlet="error; context: {controlName: 'recipientBankName', controlNameVi: 'Ngân hàng'}">
          </ng-container>
        </ng-template>
      </span>
    </div>
    <!--#endregion -->

     <!-- #region Tên khách hàng (*) -->
    <div class="form-group row">
      <span class="col-lg-12 col-form-label textLabel">Tên khách hàng <span class="text-danger">(*)</span></span>
      <span class="col-lg-12">
        <input type="text" [value]="recipientFullName" class="form-control" disabled
          [class.input-error]="form.controls['recipientFullName'].invalid && form.controls['recipientFullName'].touched">
        <ng-container
          *ngTemplateOutlet="error; context: {controlName: 'recipientFullName', controlNameVi: 'Tên khách hàng'}">
        </ng-container>
      </span>
    </div>
    <!--#endregion -->
  </div>
</app-external-transfer-form>

<hr/>
<ng-content select=".fixed-detail"></ng-content>
